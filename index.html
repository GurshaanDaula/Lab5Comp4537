<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Lab 5 Client â€“ Patient DB</title>
  <script>
    const apiBase = "https://lab5comp4537server2.onrender.com/api/v1/sql"; 

    async function sendQuery() {
      const q = document.getElementById("query").value.trim();
      if (!q) return alert("Enter a query.");

      try {
        let res;
        if (q.toLowerCase().startsWith("insert")) {
          // POST request for INSERTs
          res = await fetch(apiBase, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ query: q })
          });
        } else if (q.toLowerCase().startsWith("select")) {
          // GET request for SELECTs
          res = await fetch(`${apiBase}/${encodeURIComponent(q)}`);
        } else {
          return alert("Only SELECT or INSERT queries are allowed.");
        }

        const data = await res.json();
        document.getElementById("output").textContent =
          JSON.stringify(data, null, 2);
      } catch (err) {
        document.getElementById("output").textContent = "Error: " + err.message;
      }
    }

    async function insertSample() {
      const sampleQuery = `
        INSERT INTO patient (first_name, last_name, age, gender, diagnosis)
        VALUES 
          ('John', 'Doe', 30, 'Male', 'Flu'),
          ('Jane', 'Smith', 25, 'Female', 'Cold'),
          ('Ali', 'Reza', 40, 'Male', 'Asthma'),
          ('Maria', 'Gonzalez', 45, 'Female', 'Diabetes'),
          ('Chris', 'Lee', 29, 'Male', 'Allergy');
      `;
      document.getElementById("query").value = sampleQuery;
      await sendQuery();
    }
  </script>
</head>

<body>
  <h2>Patient DB Client</h2>
  <button onclick="insertSample()">Insert Sample Rows</button><br><br>

  <textarea id="query" rows="5" cols="70"
    placeholder="Enter SQL (SELECT or INSERT only)">SELECT * FROM patient;</textarea><br>

  <button onclick="sendQuery()">Submit Query</button>
  <pre id="output"></pre>
</body>

</html>
